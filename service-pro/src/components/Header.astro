---
import { SITE } from "@/config/site";

/**
 * Genera el tel: a partir de phoneDisplay (sin depender de SITE.phoneTel).
 * Ej: "+54 11 3137-7110" -> "+541131377110"
 */
const phoneTel = String(SITE.phoneDisplay || "").replace(/[^\d+]/g, "");

const wa =
  `https://wa.me/${SITE.whatsappE164}?text=` +
  encodeURIComponent("Hola! Quiero coordinar una visita técnica.");

const WaIcon = `
<svg viewBox="0 0 32 32" aria-hidden="true">
  <path d="M19.11 17.7c-.25-.13-1.47-.72-1.7-.81-.23-.09-.4-.13-.56.13-.16.25-.64.81-.78.97-.14.16-.29.19-.54.06-.25-.13-1.06-.39-2.02-1.25-.75-.67-1.25-1.49-1.4-1.74-.14-.25-.02-.39.11-.52.11-.11.25-.29.38-.43.13-.14.16-.25.25-.4.09-.16.05-.29-.02-.43-.07-.13-.56-1.35-.77-1.84-.2-.48-.41-.41-.56-.41h-.48c-.16 0-.43.06-.65.29-.22.23-.85.83-.85 2.03s.87 2.35.99 2.52c.13.16 1.71 2.61 4.14 3.66.58.25 1.03.4 1.38.51.58.18 1.1.16 1.52.1.46-.07 1.47-.6 1.68-1.17.21-.58.21-1.07.14-1.17-.06-.1-.23-.16-.48-.29z"/>
  <path d="M26.67 5.33A14.55 14.55 0 0 0 16.02.86C8.09.86 1.64 7.3 1.64 15.23c0 2.53.66 4.99 1.92 7.16L1.5 30.86l8.68-2.27a14.35 14.35 0 0 0 5.84 1.25h.01c7.93 0 14.38-6.45 14.38-14.38 0-3.84-1.5-7.45-4.24-10.13zM16.02 27.5h-.01c-1.95 0-3.86-.52-5.53-1.49l-.4-.24-5.15 1.35 1.37-5.02-.26-.41a11.92 11.92 0 0 1-1.85-6.46c0-6.6 5.37-11.97 11.98-11.97a11.9 11.9 0 0 1 8.49 3.51 11.9 11.9 0 0 1 3.52 8.48c0 6.61-5.37 11.98-11.16 11.98z"/>
</svg>`;
---
<header class="header">
  <div class="container header__inner">
    <!-- Brand -->
    <a class="brand" href="/" aria-label="Ir al inicio">
      <img class="brand__logo" src="/logo-service-pro.png" alt={`${SITE.name} logo`} />
      <span class="brand__text">
        <span class="brand__name">{SITE.name}</span>
        <span class="brand__tagline">{SITE.tagline}</span>
      </span>
    </a>

    <!-- Nav desktop -->
    <nav class="nav" aria-label="Navegación principal">
      <a class="nav__link" href="/#servicios">Servicios</a>
      <a class="nav__link" href="/#como-funciona">Cómo funciona</a>
      <a class="nav__link" href="/zonas">Zonas</a>
      <a class="nav__link" href="/preguntas-frecuentes">Preguntas frecuentes</a>
      <a class="nav__link" href="/contacto">Contacto</a>
    </nav>

    <!-- CTA -->
    <div class="header__cta">
      <a
        class="phoneLink"
        href={`tel:${phoneTel}`}
        aria-label={`Llamar al ${SITE.phoneDisplay}`}
      >
        {SITE.phoneDisplay}
      </a>

      <a class="waIconBtn" href={wa} aria-label="Reservar por WhatsApp">
        <span class="btn__icon" set:html={WaIcon} />
      </a>

      <button class="menuBtn" type="button" aria-label="Abrir menú" data-menu-open>
        <span class="menuIcon" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div class="sheet" id="mobileMenu" aria-hidden="true">
    <div class="sheet__backdrop" data-menu-close></div>

    <div class="sheet__panel" role="dialog" aria-modal="true" aria-label="Menú">
      <div class="sheet__top">
        <div class="sheet__title">Menú</div>
        <button class="sheet__close" type="button" aria-label="Cerrar menú" data-menu-close>
          ✕
        </button>
      </div>

      <div class="sheet__content">
        <a class="sheet__link" href="/#servicios" data-menu-close>Servicios</a>
        <a class="sheet__link" href="/#como-funciona" data-menu-close>Cómo funciona</a>
        <a class="sheet__link" href="/zonas" data-menu-close>Zonas</a>
        <a class="sheet__link" href="/preguntas-frecuentes" data-menu-close>Preguntas frecuentes</a>
        <a class="sheet__link" href="/contacto" data-menu-close>Contacto</a>

        <div class="sheet__cta">
          <a class="btn btn--wa btn--block" href={wa}>
            <span class="btn__icon" set:html={WaIcon} />
            <span>Reservar por WhatsApp</span>
          </a>

          <div class="sheet__phone">{SITE.phoneDisplay}</div>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    const sheet = document.getElementById("mobileMenu");
    const openBtn = document.querySelector("[data-menu-open]");
    const closeEls = document.querySelectorAll("[data-menu-close]");

    function openMenu(){
      sheet?.classList.add("is-open");
      sheet?.setAttribute("aria-hidden","false");
      document.documentElement.style.overflow = "hidden";
    }

    function closeMenu(){
      sheet?.classList.remove("is-open");
      sheet?.setAttribute("aria-hidden","true");
      document.documentElement.style.overflow = "";
    }

    openBtn?.addEventListener("click", openMenu);
    closeEls.forEach(el => el.addEventListener("click", closeMenu));
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape") closeMenu();
    });
  </script>
</header>
