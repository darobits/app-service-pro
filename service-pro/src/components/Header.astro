---
import { SITE } from "@/config/site";

/**
 * Genera el tel: a partir de phoneDisplay (sin depender de SITE.phoneTel).
 * Ej: "+54 11 3137-7110" -> "+541131377110"
 */
const phoneTel = String(SITE.phoneDisplay || "").replace(/[^\d+]/g, "");

const wa =
  `https://wa.me/${SITE.whatsappE164}?text=` +
  encodeURIComponent("Hola! Quiero coordinar una visita técnica.");
---

<header class="header">
  <div class="container header__inner">
    <!-- Brand -->
    <a class="brand" href="/" aria-label="Ir al inicio">
      <img class="brand__logo" src="/logo-service-pro.png" alt={`${SITE.name} logo`} />
      <span class="brand__text">
        <span class="brand__name">{SITE.name}</span>
        <span class="brand__tagline">{SITE.tagline}</span>
      </span>
    </a>

    <!-- Nav desktop -->
    <nav class="nav" aria-label="Navegación principal">
      <a class="nav__link" href="/#servicios">Servicios</a>
      <a class="nav__link" href="/#como-funciona">Cómo funciona</a>
      <a class="nav__link" href="/zonas">Zonas</a>
      <a class="nav__link" href="/preguntas-frecuentes">Preguntas frecuentes</a>
      <a class="nav__link" href="/contacto">Contacto</a>
    </nav>

    <!-- CTA -->
    <div class="header__cta">
      <a class="phoneLink" href={`tel:${phoneTel}`} aria-label={`Llamar al ${SITE.phoneDisplay}`}>
        {SITE.phoneDisplay}
      </a>

      <!-- ✅ WhatsApp icon button (Bootstrap Icons) -->
      <a class="waIconBtn" href={wa} aria-label="Reservar por WhatsApp" title="WhatsApp">
        <i class="bi bi-whatsapp waIcon" aria-hidden="true"></i>
      </a>

      <button class="menuBtn" type="button" aria-label="Abrir menú" data-menu-open>
        <span class="menuIcon" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div class="sheet" id="mobileMenu" aria-hidden="true">
    <div class="sheet__backdrop" data-menu-close></div>

    <div class="sheet__panel" role="dialog" aria-modal="true" aria-label="Menú">
      <div class="sheet__top">
        <div class="sheet__title">Menú</div>
        <button class="sheet__close" type="button" aria-label="Cerrar menú" data-menu-close>
          ✕
        </button>
      </div>

      <div class="sheet__content">
        <a class="sheet__link" href="/#servicios" data-menu-close>Servicios</a>
        <a class="sheet__link" href="/#como-funciona" data-menu-close>Cómo funciona</a>
        <a class="sheet__link" href="/zonas" data-menu-close>Zonas</a>
        <a class="sheet__link" href="/preguntas-frecuentes" data-menu-close>Preguntas frecuentes</a>
        <a class="sheet__link" href="/contacto" data-menu-close>Contacto</a>

        <div class="sheet__cta">
          <a class="btn btn--wa btn--block" href={wa}>
            <span class="btn__icon" aria-hidden="true"><i class="bi bi-whatsapp"></i></span>
            <span>Reservar por WhatsApp</span>
          </a>

          <div class="sheet__phone">{SITE.phoneDisplay}</div>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    const sheet = document.getElementById("mobileMenu");
    const openBtn = document.querySelector("[data-menu-open]");
    const closeEls = document.querySelectorAll("[data-menu-close]");

    function openMenu(){
      sheet?.classList.add("is-open");
      sheet?.setAttribute("aria-hidden","false");
      document.documentElement.style.overflow = "hidden";
    }

    function closeMenu(){
      sheet?.classList.remove("is-open");
      sheet?.setAttribute("aria-hidden","true");
      document.documentElement.style.overflow = "";
    }

    openBtn?.addEventListener("click", openMenu);
    closeEls.forEach(el => el.addEventListener("click", closeMenu));
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape") closeMenu();
    });
  </script>
</header>
